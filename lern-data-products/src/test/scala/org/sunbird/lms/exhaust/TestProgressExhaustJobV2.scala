package org.sunbird.lms.exhaust

import okhttp3.mockwebserver.{Dispatcher, MockResponse, MockWebServer, RecordedRequest}
import org.apache.spark.sql.functions.col
import org.apache.spark.sql.{Encoders, SparkSession}
import org.ekstep.analytics.framework.conf.AppConf
import org.ekstep.analytics.framework.util.{HadoopFileUtil, JSONUtils}
import org.ekstep.analytics.framework.{FrameworkContext, JobConfig}
import org.scalamock.scalatest.MockFactory
import org.sunbird.core.exhaust.BaseReportsJob
import org.sunbird.core.util.{BaseSpec, EmbeddedCassandra, EmbeddedPostgresql, RedisConnect}
import org.sunbird.lms.exhaust.collection.{AssessmentData, ProgressExhaustJobV2}
import redis.embedded.RedisServer

import java.text.SimpleDateFormat
import java.util.Calendar
import scala.collection.JavaConverters._

class TestProgressExhaustJobV2 extends BaseSpec with MockFactory with BaseReportsJob {

  val jobRequestTable = "job_request"
  implicit var spark: SparkSession = _

  var redisServer: RedisServer = _

  val esServer = new MockWebServer()

  val esDispatcher: Dispatcher = new Dispatcher() {
    @throws[InterruptedException]
    override def dispatch(request: RecordedRequest): MockResponse = {
      (request.getPath, request.getMethod) match {
        case ("/api/content/v1/search", "POST") =>
          new MockResponse().setHeader("Content-Type", "application/json").setResponseCode(200).setBody("""{"id":"api.content.search","ver":"1.0","ts":"2023-02-16T07:19:30.405Z","params":{"resmsgid":"4102b950-adca-11ed-90b2-b7bf811d5c69","msgid":"40fbdb80-adca-11ed-a723-4b0cc0e91be5","status":"successful","err":null,"errmsg":null},"responseCode":"OK","result":{"count":712392,"content":[{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"b00bc992ef25f1a9a8d63291e20efc8d","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_1130928636168192001667","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2019-11-15 05:41:50:382+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2019-11-15 05:41:50:382+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2019-11-15 05:41:50:382+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2019-11-15 05:41:50:382+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2019-11-15 05:41:50:382+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"b00bc992ef25f1a9a8d63291e20efc8d","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_112876961957437440179","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2019-11-15 05:41:50:382+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_1128870328040161281204","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_1130293726460805121168","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_1131975645014835201326","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_112835334818643968148","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_11234577983855001618","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_1130292569979781121111","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_11306040245271756813015","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608},{"ownershipType":["createdBy"],"publish_type":"public","unitIdentifiers":["do_21337599437489766414999"],"copyright":"Test axis,2126","se_gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"previewUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","organisationId":"c5b2b2b9-fafa-4909-8d5d-f9458d1a3881","keywords":["All_Contents"],"subject":["Hindi"],"downloadUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","channel":"channel-01","language":["English"],"variants":{"full":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091450835_do_21337600715072307215013_2.ecar","size":"262229"},"spine":{"ecarUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/learning-resource_1671091451013_do_21337600715072307215013_2_SPINE.ecar","size":"7647"}},"source":"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013","mimeType":"application/pdf","objectType":"Content","se_mediums":["English"],"appIcon":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.thumb.jpg","gradeLevel":["Class 10"],"primaryCategory":"Learning Resource","appId":"staging.dock.portal","artifactUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","contentEncoding":"identity","contentType":"PreviousBoardExamPapers","se_gradeLevels":["Class 10"],"trackable":{"enabled":"No","autoBatch":"No"},"identifier":"do_1128870328040161281204","se_boardIds":["ekstep_ncert_k-12_board_cbse"],"subjectIds":["ekstep_ncert_k-12_subject_hindi"],"audience":["Student"],"visibility":"Default","consumerId":"cb069f8d-e4e1-46c5-831f-d4a83b323ada","author":"paul1","discussionForum":{"enabled":"No"},"mediaType":"content","osId":"org.ekstep.quiz.app","lastPublishedBy":"9c9b3259-f137-491a-bae5-fe2ad1763647","languageCode":["en"],"graph_id":"domain","nodeType":"DATA_NODE","version":2,"pragma":["external"],"se_subjects":["Hindi"],"prevState":"Review","license":"CC BY 4.0","lastPublishedOn":"2022-12-15T08:04:10.835+0000","size":270173,"name":"24 aug course","topic":["कर चले हम फ़िदा"],"mediumIds":["ekstep_ncert_k-12_medium_english"],"attributions":[""],"status":"Live","topicsIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"interceptionPoints":"{}","code":"05747b0c-cec4-61fd-52b6-1c4239c662ae","credentials":{"enabled":"No"},"prevStatus":"Draft","origin":"do_21337600715072307215013","description":"\"This is nadiya\"*","streamingUrl":"https://obj.stage.sunbirded.org/sunbird-content-staging/content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","medium":["English"],"posterImage":"https://stagingdock.blob.core.windows.net/sunbird-content-dock/content/do_21337600715072307215013/artifact/apple-fruit.jpg","idealScreenSize":"normal","createdOn":"2021-09-28T07:27:30.535+0000","se_boards":["CBSE"],"se_mediumIds":["ekstep_ncert_k-12_medium_english"],"processId":"0c7a375e-fe42-4836-8e2d-e901d03a600e","contentDisposition":"inline","lastUpdatedOn":"2022-12-15T08:04:11.060+0000","originData":"{\"identifier\":\"do_21337600715072307215013\",\"repository\":\"https://dockstaging.sunbirded.org/api/content/v1/read/do_21337600715072307215013\"}","se_topicIds":["ekstep_ncert_k-12_topic_62113a9a1815b8f14e3103458f2b7c56cf2eeaf5"],"collectionId":"batch-001","dialcodeRequired":"No","createdFor":["01329314824202649627"],"creator":"paul1@yopmail.com","lastStatusChangedOn":"2022-12-15T08:04:11.060+0000","os":["All"],"cloudStorageKey":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","se_subjectIds":["ekstep_ncert_k-12_subject_hindi"],"se_FWIds":["ekstep_ncert_k-12"],"targetFWIds":["ekstep_ncert_k-12"],"pkgVersion":2,"versionKey":"1632814052871","migrationVersion":1.1,"idealScreenDensity":"hdpi","s3Key":"content/do_21337600715072307215013/artifact/do_21337600715072307215013_1632814051137_do_21337600715072307215013_1632813407308_pdf_229.pdf","boardIds":["ekstep_ncert_k-12_board_cbse"],"framework":"ekstep_ncert_k-12","lastSubmittedOn":"2021-09-28T07:27:32.821+0000","createdBy":"5b39b2a0-e9ba-4bab-9b05-91ad2e28b626","se_topics":["कर चले हम फ़िदा"],"compatibilityLevel":4,"gradeLevelIds":["ekstep_ncert_k-12_gradelevel_class10"],"programId":"b9b8eb80-2027-11ec-bd97-0d10d9b33e3f","board":"CBSE","node_id":1116608}]}}""")
      }
    }
  }

  override def beforeAll(): Unit = {
    spark = getSparkSession();
    super.beforeAll()
    redisServer = new RedisServer(6341)
    redisServer.start()
    esServer.setDispatcher(esDispatcher)
    esServer.start(9080)
    setupRedisData()
    EmbeddedCassandra.loadData("src/test/resources/exhaust/progress-exhaust-v2.cql") // Load test data in embedded cassandra server
    EmbeddedPostgresql.start()
    EmbeddedPostgresql.createJobRequestTable()
  }

  override def afterAll(): Unit = {
    super.afterAll()
    redisServer.stop()
    println("******** closing the redis connection **********" + redisServer.isActive)
    EmbeddedCassandra.close()
    EmbeddedPostgresql.close()
    esServer.close()
    spark.close()
  }

  def setupRedisData(): Unit = {
    val redisConnect = new RedisConnect("localhost", 6341)
    val jedis = redisConnect.getConnection(0, 100000)
    jedis.hmset("user:user-001", JSONUtils.deserialize[java.util.Map[String, String]]("""{"cluster":"CLUSTER1","firstname":"Manju","subject":"[\"IRCS\"]","schooludisecode":"3183211","usertype":"administrator","usersignintype":"Validated","language":"[\"English\"]","medium":"[\"English\"]","userid":"a962a4ff-b5b5-46ad-a9fa-f54edf1bcccb","schoolname":"DPS, MATHURA","rootorgid":"01250894314817126443","lastname":"Kapoor","framework":"[\"sunbird_health\"]","orgname":"Root Org2","phone":"","usersubtype":"deo","district":"bengaluru","grade":"[\"Volunteers\"]","block":"BLOCK1","state":"Karnataka","board":"[\"Sunbird-Health\"]","email":""};"""))
    jedis.hmset("user:user-002", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Mahesh", "userid": "user-002", "state": "Andhra Pradesh", "district": "bengaluru", "userchannel": "sunbird-dev", "rootorgid": "0130107621805015045", "email": "mahesh@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-003", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Sowmya", "userid": "user-003","usertype":"administrator", "usersubtype":"deo", "cluster": "anagha" ,"state": "Karnataka", "district": "bengaluru", "userchannel": "sunbird-dev", "rootorgid": "0130107621805015045", "email": "sowmya@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-004", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Utkarsha", "userid": "user-004", "state": "Delhi", "district": "babarpur", "userchannel": "sunbird-dev", "rootorgid": "01250894314817126443", "email": "utkarsha@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-005", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Isha", "userid": "user-005", "state": "MP", "district": "Jhansi", "userchannel": "sunbird-dev", "rootorgid": "01250894314817126443", "email": "isha@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-006", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Revathi", "userid": "user-006", "state": "Andhra Pradesh", "district": "babarpur", "userchannel": "sunbird-dev", "rootorgid": "01250894314817126443", "email": "revathi@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-007", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Sunil", "userid": "user-007", "state": "Karnataka", "district": "bengaluru", "userchannel": "sunbird-dev", "rootorgid": "0126391644091351040", "email": "sunil@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-008", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Anoop", "userid": "user-008", "state": "Karnataka", "district": "bengaluru", "userchannel": "sunbird-dev", "rootorgid": "0130107621805015045", "email": "anoop@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-009", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Kartheek", "userid": "user-009", "state": "Karnataka", "district": "bengaluru", "userchannel": "sunbird-dev", "rootorgid": "01285019302823526477", "email": "kartheekp@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-010", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Anand", "userid": "user-010", "state": "Tamil Nadu", "district": "Chennai", "userchannel": "sunbird-dev", "rootorgid": "0130107621805015045", "email": "anandp@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-011", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Santhosh", "userid": "user-011", "state": "Tamil Nadu", "district": "Chennai", "userchannel": "sunbird-dev", "rootorgid": "0130107621805015045", "email": "anandp@ilimi.in", "usersignintype": "Validated"};"""))
    jedis.hmset("user:user-012", JSONUtils.deserialize[java.util.Map[String, String]]("""{"firstname": "Rayulu", "userid": "user-012","usertype":"administrator", "usersubtype":"deo", "cluster": "anagha", "state": "Tamil Nadu", "district": "Chennai", "userchannel": "sunbird-dev", "rootorgid": "0130107621805015045", "email": "anandp@ilimi.in", "usersignintype": "Validated"};"""))

    jedis.close()
  }

  ignore should "generate the report with all the correct data" in {

    EmbeddedPostgresql.execute(s"TRUNCATE $jobRequestTable")
    EmbeddedPostgresql.execute("INSERT INTO job_request (tag, request_id, job_id, status, request_data, requested_by, requested_channel, dt_job_submitted, download_urls, dt_file_created, dt_job_completed, execution_time, err_message ,iteration, encryption_key) VALUES ('do_1130928636168192001667_batch-001:channel-01', '37564CF8F134EE7532F125651B51D17F', 'progress-exhaust', 'SUBMITTED', '{\"batchId\": \"batch-001\"}', 'user-002', 'b00bc992ef25f1a9a8d63291e20efc8d', '2020-10-19 05:58:18.666', '{}', NULL, NULL, 0, '' ,0, 'test12');")

    implicit val fc = new FrameworkContext()
    val strConfig = """{"search":{"type":"none"},"model":"org.sunbird.lms.exhaust.collection.ProgressExhaustJobV2","modelParams":{"store":"local","mode":"OnDemand","batchFilters":["TPD"],"searchFilter":{},"sparkElasticsearchConnectionHost":"{{ sunbird_es_host }}","sparkRedisConnectionHost":"localhost","sparkUserDbRedisPort":6341,"sparkUserDbRedisIndex":"0","sparkCassandraConnectionHost":"localhost","fromDate":"","toDate":"","storageContainer":""},"parallelization":8,"appName":"Progress Exhaust V2"}"""
    val jobConfig = JSONUtils.deserialize[JobConfig](strConfig)
    implicit val config = jobConfig
    ProgressExhaustJobV2.execute()

    val outputLocation = AppConf.getConfig("collection.exhaust.store.prefix")
    val outputDir = "progress-exhaust"
    val batch1 = "batch-001"
    val requestId = "37564CF8F134EE7532F125651B51D17F"
    val filePath = ProgressExhaustJobV2.getFilePath(batch1, requestId)
    val jobName = ProgressExhaustJobV2.jobName()

    implicit val responseExhaustEncoder = Encoders.product[ProgressExhaustReport]
    val batchResult = spark.read.format("csv").option("header", "true")
      .load(s"$outputLocation/$filePath.csv")

    val filteredDF = batchResult.toDF().filter(col("Collection Id") === "do_1130928636168192001667"
      && col("Batch Id") === "BatchId_batch-001" && col("User UUID") === "user-001")
    import org.apache.spark.sql.SparkSession
    val spark1 = SparkSession.builder.getOrCreate
    import spark1.implicits._

    filteredDF.select("progress").rdd.map(r => r(0)).collect.toList.head should be("100")
    filteredDF.select("Total Score").rdd.map(r => r(0)).collect.toList.head should be("100%")
    filteredDF.select("do_1128870328040161281204 - Score").rdd.map(r => r(0)).collect.toList.head should be("100%")

    val batch1Results = batchResult.as[ProgressExhaustReport].collectAsList().asScala
    batch1Results.size should be(4)
    batch1Results.map(f => f.`Collection Id`).toList should contain atLeastOneElementOf List("do_1130928636168192001667")
    batch1Results.map(f => f.`Collection Name`).toList should contain atLeastOneElementOf List("24 aug course")
    batch1Results.map(f => f.`Batch Id`).toList should contain atLeastOneElementOf List("BatchId_batch-001")
    batch1Results.map(f => f.`Batch Name`).toList should contain atLeastOneElementOf List("Basic Java")
    batch1Results.map { res => res.`User UUID` }.toList should contain theSameElementsAs List("user-001", "user-002", "user-003", "user-004")
    batch1Results.map { res => res.`State` }.toList should contain theSameElementsAs List("Karnataka", "Andhra Pradesh", "Karnataka", "Delhi")
    batch1Results.map { res => res.`District` }.toList should contain theSameElementsAs List("bengaluru", "bengaluru", "bengaluru", "babarpur")
    batch1Results.map(f => f.`Enrolment Date`).toList should contain allElementsOf List("15/11/2019")
    batch1Results.map(f => f.`Completion Date`).toList should contain allElementsOf List(null)
    batch1Results.map(f => f.`Progress`).toList should contain allElementsOf List("100")
    batch1Results.map(f => f.`Cluster Name`).toList should contain atLeastOneElementOf List("CLUSTER1")
    batch1Results.map(f => f.`User Type`).toList should contain atLeastOneElementOf List("administrator")
    batch1Results.map(f => f.`User Sub Type`).toList should contain atLeastOneElementOf List("deo")
    //
    val pResponse = EmbeddedPostgresql.executeQuery("SELECT * FROM job_request WHERE job_id='progress-exhaust'")
    val reportDate = getDate("yyyyMMdd").format(Calendar.getInstance().getTime)

    while (pResponse.next()) {
      pResponse.getString("status") should be("SUCCESS")
      pResponse.getString("err_message") should be("")
      pResponse.getString("dt_job_submitted") should be("2020-10-19 05:58:18.666")
      pResponse.getString("download_urls") should be(s"""{progress-exhaust/$requestId/batch-001_progress_${reportDate}.zip}""")
      pResponse.getString("dt_file_created") should be(null)
      pResponse.getString("iteration") should be("0")
    }

    new HadoopFileUtil().delete(spark.sparkContext.hadoopConfiguration, outputLocation)

    //Test coverage for filterAssessmentsFromHierarchy method
    val assessmentData = ProgressExhaustJobV2.filterAssessmentsFromHierarchy(List(), Map(), AssessmentData("do_1130928636168192001667", List()))
    assessmentData.courseid should be("do_1130928636168192001667")
    assert(assessmentData.assessmentIds.isEmpty)

  }

  ignore should "make request as failed and add error message for invalid request_data" in {

    EmbeddedPostgresql.execute(s"TRUNCATE $jobRequestTable")
    // batchid or batchfilter should present
    EmbeddedPostgresql.execute("INSERT INTO job_request (tag, request_id, job_id, status, request_data, requested_by, requested_channel, dt_job_submitted, download_urls, dt_file_created, dt_job_completed, execution_time, err_message ,iteration, encryption_key) VALUES ('do_1130928636168192001667_batch-001:channel-01', '37564CF8F134EE7532F125651B51D17F', 'progress-exhaust', 'SUBMITTED', '{\"batchFilter\": \" \"}', 'user-002', 'b00bc992ef25f1a9a8d63291e20efc8d', '2020-10-19 05:58:18.666', '{}', NULL, NULL, 0, '' ,0, 'test12');")

    implicit val fc = new FrameworkContext()

    val strConfig = """{"search":{"type":"none"},"model":"org.sunbird.lms.exhaust.collection.ProgressExhaustJobV2","modelParams":{"store":"local","mode":"OnDemand","batchFilters":["TPD"],"searchFilter":{},"sparkElasticsearchConnectionHost":"{{ sunbird_es_host }}","sparkRedisConnectionHost":"localhost","sparkUserDbRedisPort":6341,"sparkUserDbRedisIndex":"0","sparkCassandraConnectionHost":"localhost","fromDate":"","toDate":"","storageContainer":""},"parallelization":8,"appName":"Progress Exhaust V2"}"""
    val jobConfig = JSONUtils.deserialize[JobConfig](strConfig)
    implicit val config = jobConfig
    ProgressExhaustJobV2.execute()

    val pResponse = EmbeddedPostgresql.executeQuery("SELECT * FROM job_request WHERE job_id='progress-exhaust'")
    val reportDate = getDate("yyyyMMdd").format(Calendar.getInstance().getTime)

    while (pResponse.next()) {
      pResponse.getString("request_id") should be("37564CF8F134EE7532F125651B51D17F")
      pResponse.getString("status") should be("FAILED")
      pResponse.getString("err_message") should include ("Internal Server Error:")
    }
  }

  ignore should "validate the report path" in {
    val batch1 = "batch-001"
    val requestId = "37564CF8F134EE7532F125651B51D17F"
    val strConfig = """{"search":{"type":"none"},"model":"org.sunbird.lms.exhaust.collection.ProgressExhaustJob","modelParams":{"store":"local","mode":"OnDemand","batchFilters":["TPD"],"searchFilter":{},"sparkElasticsearchConnectionHost":"{{ sunbird_es_host }}","sparkRedisConnectionHost":"localhost","sparkUserDbRedisPort":6341,"sparkUserDbRedisIndex":"0","sparkCassandraConnectionHost":"localhost","fromDate":"","toDate":"","storageContainer":""},"parallelization":8,"appName":"Progress Exhaust"}"""
    val jobConfig = JSONUtils.deserialize[JobConfig](strConfig)
    implicit val config = jobConfig
    val onDemandModeFilepath = ProgressExhaustJobV2.getFilePath(batch1, requestId)
    val reportDate = getDate("yyyyMMdd").format(Calendar.getInstance().getTime())
    onDemandModeFilepath should be(s"progress-exhaust/$requestId/batch-001_progress_$reportDate")

    val standAloneModeFilePath = ProgressExhaustJobV2.getFilePath(batch1, "")
    standAloneModeFilePath should be(s"progress-exhaust/batch-001_progress_$reportDate")
  }

  def getDate(pattern: String): SimpleDateFormat = {
    new SimpleDateFormat(pattern)
  }


//  it should "Generate a report for StandAlone Mode" in {
//    implicit val fc = new FrameworkContext()
//    val strConfig = """{"search":{"type":"none"},"model":"org.sunbird.lms.exhaust.collection.ProgressExhaustJobV2","modelParams":{"store":"local","mode":"standalone","batchFilters":["TPD"],"searchFilter":{"request":{"filters":{"status":["Live"],"contentType":"Course"},"fields":["identifier","name","organisation","channel"],"limit":10}},"sparkElasticsearchConnectionHost":"{{ sunbird_es_host }}","sparkRedisConnectionHost":"localhost","sparkUserDbRedisPort":6341,"sparkUserDbRedisIndex":"0","sparkCassandraConnectionHost":"localhost","fromDate":"","toDate":"","storageContainer":""},"parallelization":8,"appName":"Progress Exhaust Job V2"}"""
//    val jobConfig = JSONUtils.deserialize[JobConfig](strConfig)
//    implicit val config = jobConfig
//    ProgressExhaustJobV2.execute()
//    val outputLocation = AppConf.getConfig("collection.exhaust.store.prefix")
//    val batch1 = "batch-001"
//    val filePath = ProgressExhaustJobV2.getFilePath(batch1, "")
//    implicit val responseExhaustEncoder = Encoders.product[ProgressExhaustReport]
//    val batch1Results = spark.read.format("csv").option("header", "true")
//      .load(s"$outputLocation/$filePath.csv").as[ProgressExhaustReport].collectAsList().asScala
//
//
//    batch1Results.size should be(4)
//    batch1Results.map(f => f.`Collection Id`).toList should contain atLeastOneElementOf List("do_1130928636168192001667")
//    batch1Results.map(f => f.`Collection Name`).toList should contain atLeastOneElementOf List("24 aug course")
//    batch1Results.map(f => f.`Batch Id`).toList should contain atLeastOneElementOf List("BatchId_batch-001")
//    batch1Results.map(f => f.`Batch Name`).toList should contain atLeastOneElementOf List("Basic Java")
//    batch1Results.map { res => res.`User UUID` }.toList should contain theSameElementsAs List("user-001", "user-002", "user-003", "user-004")
//    batch1Results.map { res => res.`State` }.toList should contain theSameElementsAs List("Karnataka", "Andhra Pradesh", "Karnataka", "Delhi")
//    batch1Results.map { res => res.`District` }.toList should contain theSameElementsAs List("bengaluru", "bengaluru", "bengaluru", "babarpur")
//    batch1Results.map(f => f.`Enrolment Date`).toList should contain allElementsOf List("15/11/2019")
//    batch1Results.map(f => f.`Completion Date`).toList should contain allElementsOf List(null)
//    batch1Results.map(f => f.`Progress`).toList should contain allElementsOf List("100")
//    batch1Results.map(f => f.`Cluster Name`).toList should contain atLeastOneElementOf List("CLUSTER1")
//    batch1Results.map(f => f.`User Type`).toList should contain atLeastOneElementOf List("administrator")
//    batch1Results.map(f => f.`User Sub Type`).toList should contain atLeastOneElementOf List("deo")
//  }
}
